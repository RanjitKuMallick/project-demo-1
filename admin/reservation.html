<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Reservations</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body.dark-mode {
      background-color: #121212;
      color: #f0f0f0;
    }
    .table.dark-mode {
      background-color: #1e1e1e;
      color: #ffffff;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
    <a class="navbar-brand" href="dashboard.html">‚Üê Back to Dashboard</a>
    <div class="ms-auto">
      <button class="btn btn-outline-light" id="darkModeToggle">üåô</button>
    </div>
  </nav>

  <div class="container mt-4">
    <h3>Table Reservations</h3>

    <table class="table table-bordered mt-4">
      <thead class="table-dark">
        <tr>
          <th>Name</th>
          <th>Date</th>
          <th>Time</th>
          <th>Guests</th>
          <th>Contact</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="reservationTableBody">
        <!-- Dynamic content -->
      </tbody>
    </table>
  </div>

  <!-- JS Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

  <script>
    emailjs.init("ci-JHDWo1WGRSl8OP"); // Your actual public key

    function loadReservations() {
      const reservations = JSON.parse(localStorage.getItem("bitcrave-reservations")) || [];
      const tbody = document.getElementById("reservationTableBody");
      tbody.innerHTML = "";

      reservations.forEach((r, index) => {
        const badgeClass = r.status === "Confirmed" ? "success"
                          : r.status === "Cancelled" ? "danger"
                          : "warning";

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${r.name}</td>
          <td>${r.date}</td>
          <td>${r.time}</td>
          <td>${r.guests}</td>
          <td>${r.email || "No email"}<br><small>${r.phone || "No phone"}</small></td>
          <td><span class="badge bg-${badgeClass}">${r.status}</span></td>
          <td>
            ${r.status !== "Confirmed" ? `<button class="btn btn-success btn-sm" onclick="updateStatus(${index}, 'Confirmed')">Confirm</button>` : ""}
            ${r.status !== "Cancelled" ? `<button class="btn btn-danger btn-sm" onclick="updateStatus(${index}, 'Cancelled')">Cancel</button>` : ""}
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function updateStatus(index, newStatus) {
      const reservations = JSON.parse(localStorage.getItem("bitcrave-reservations")) || [];
      const r = reservations[index];
      r.status = newStatus;
      localStorage.setItem("bitcrave-reservations", JSON.stringify(reservations));
      loadReservations();

      // ‚úÖ Send Email if Confirmed
      if (newStatus === "Confirmed" && r.email) {
        emailjs.send("service_xj1e9a6", "template_h9zgibs", {
          to_name: r.name,
          to_email: r.email,
          date: r.date,
          time: r.time,
          guests: r.guests
        }).then(
          () => console.log("‚úÖ Confirmation email sent to " + r.email),
          (err) => console.error("‚ùå Email send failed:", err)
        );
      }
    }

    // Dark Mode Toggle
    if (localStorage.getItem("bitcrave-theme") === "dark") {
      document.body.classList.add("dark-mode");
      document.querySelectorAll('.table').forEach(el => el.classList.add('dark-mode'));
    }

    document.getElementById("darkModeToggle").addEventListener("click", () => {
      document.body.classList.toggle("dark-mode");
      document.querySelectorAll('.table').forEach(el => el.classList.toggle('dark-mode'));
      const theme = document.body.classList.contains("dark-mode") ? "dark" : "light";
      localStorage.setItem("bitcrave-theme", theme);
    });
    function confirmBooking(index) {
  const reservations = JSON.parse(localStorage.getItem("bitcrave-reservations")) || [];
  reservations[index].status = "Confirmed";
  localStorage.setItem("bitcrave-reservations", JSON.stringify(reservations));
  alert("Booking confirmed!");
  location.reload();
}
    function cancelBooking(index) {
      const reservations = JSON.parse(localStorage.getItem("bitcrave-reservations")) || [];
      reservations[index].status = "Cancelled";
      localStorage.setItem("bitcrave-reservations", JSON.stringify(reservations));
      alert("Booking cancelled!");
      location.reload();
    }

    // Load on page ready
    window.onload = loadReservations;
  </script>
</body>
</html>
